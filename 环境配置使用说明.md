# 环境配置使用说明

## 概述

已重构 `AppConfigN` 类，支持通过一个字段来切换不同的环境配置。现在支持三种环境，每个环境包含API和WebSocket配置：

- **本地环境 (local)**: 
  - API: `http://192.168.110.140:8080`
  - WebSocket: `ws://192.168.110.140:8080/api/waiter/ws`
- **测试环境 (test)**: 
  - API: `http://129.204.154.113:8050`
  - WebSocket: `ws://129.204.154.113:8050/api/waiter/ws`
- **正式环境 (production)**: 
  - API: `http://test.api.oh06.com`
  - WebSocket: `ws://test.api.oh06.com/api/waiter/ws`

## 使用方法

### 1. 基本使用

```dart
import 'package:lib_base/config/app_configN.dart';

// 方法1：使用枚举设置环境
await AppConfigN.configuration(environment: Environment.local);
await AppConfigN.configuration(environment: Environment.test);
await AppConfigN.configuration(environment: Environment.production);

// 方法2：使用便捷方法
await AppConfigN.configureLocal();      // 设置为本地环境
await AppConfigN.configureTest();       // 设置为测试环境
await AppConfigN.configureProduction(); // 设置为生产环境

// 方法3：兼容旧版本的字符串参数（已废弃，但仍可使用）
await AppConfigN.configuration(urlType: 'local');
await AppConfigN.configuration(urlType: 'test');
await AppConfigN.configuration(urlType: 'production');
```

### 2. 获取当前配置

```dart
// 获取当前环境
Environment currentEnv = AppConfigN.currentEnvironment;
print('当前环境: ${currentEnv.name}');

// 获取当前API地址
String apiUrl = AppConfigN.baseApiUrl;
print('API地址: $apiUrl');

// 获取当前WebSocket地址
String wsUrl = AppConfigN.baseWsUrl;
print('WebSocket地址: $wsUrl');

// 检查是否为测试环境
bool isTest = AppConfigN.serverEnvironmentTest;
print('是否测试环境: $isTest');

// 检查API加密状态
bool encrypt = AppConfigN.apiEncrypt;
print('API加密: $encrypt');
```

### 3. 在应用启动时配置

在 `main.dart` 中配置环境：

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // 根据需要设置环境
  await AppConfigN.configureTest(); // 或其他环境
  
  runApp(MyApp());
}
```

### 4. 动态切换环境

```dart
// 在设置页面或调试页面中动态切换
void switchToProduction() async {
  await AppConfigN.configureProduction();
  // 可能需要重新初始化网络服务和WebSocket连接等
}

void switchToLocal() async {
  await AppConfigN.configureLocal();
  // 可能需要重新初始化网络服务和WebSocket连接等
}
```

## 环境特性

### 本地环境 (Environment.local)
- API URL: `http://192.168.110.140:8080`
- WebSocket URL: `ws://192.168.110.140:8080/api/waiter/ws`
- API加密: 关闭
- 用于本地开发和调试

### 测试环境 (Environment.test)
- API URL: `http://129.204.154.113:8050`
- WebSocket URL: `ws://129.204.154.113:8050/api/waiter/ws`
- API加密: 关闭
- 用于功能测试和集成测试

### 正式环境 (Environment.production)
- API URL: `http://test.api.oh06.com`
- WebSocket URL: `ws://test.api.oh06.com/api/waiter/ws`
- API加密: 开启
- 用于生产发布

## 兼容性

- 保持了与旧版本代码的兼容性
- `serverEnvironmentTest` 属性仍然可用
- `apiEncrypt` 属性根据环境自动配置
- 旧的 `urlType` 参数仍然支持，但建议使用新的 `environment` 参数

## WebSocket使用示例

```dart
import 'package:lib_base/utils/websocket_manager.dart';
import 'package:lib_base/config/app_configN.dart';

// 初始化WebSocket连接（会自动使用当前环境的WebSocket地址）
final success = await WebSocketManager().initializeTableConnection(
  tableId: 'table_001',
  // serverUrl 参数可省略，会自动使用 AppConfigN.baseWsUrl
  token: 'your_token_here',
  language: 'zh-CN',
);

if (success) {
  print('WebSocket连接成功');
} else {
  print('WebSocket连接失败');
}
```

## 注意事项

1. 切换环境后，可能需要重新初始化网络服务和WebSocket连接
2. 生产环境会自动启用API加密
3. 本地和测试环境会关闭API加密以便调试
4. 环境切换会在控制台输出当前环境信息（包括API和WebSocket地址）
5. WebSocket连接会自动使用当前环境配置的地址
6. 如果需要覆盖默认的WebSocket地址，可以在初始化时传入 `serverUrl` 参数
